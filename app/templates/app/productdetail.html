{% extends 'app/base.html' %}
{% load static %}
{% block title %}Product Detail{% endblock title %}

{% block main-content %}
<div class="container my-5">
  <div class="row g-5">
    <!-- Product Image -->
    <div class="col-md-6 text-center">
      <div class="card shadow-sm border-0">
        <img src="{{ product.p_image.url }}" alt="{{ product.title }}" class="img-fluid rounded-3 p-3">
      </div>
    </div>

    <!-- Product Details -->
    <div class="col-md-6">
      <h2 class="fw-bold">{{ product.title }}</h2>
      <hr>
      <p class="text-muted">{{ product.description }}</p>

      <!-- Price -->
      <h4 class="my-4">
        <span class="text-primary fw-bold">Tk. {{ product.discounted_price }}</span>
        {% if product.selling_price > product.discounted_price %}
          <small class="text-muted text-decoration-line-through">{{ product.selling_price }}</small>
        {% endif %}
      </h4>

      <!-- Buttons: Superuser OR Normal User -->
      <div class="d-flex flex-wrap gap-3 my-4">
        {% if request.user.is_superuser %}
          <!-- Superuser: Edit + Delete -->
          <a href="{% url 'product-edit' product.id %}" class="btn btn-pink shadow px-4 py-2">
            <i class="fas fa-edit me-1"></i> Edit
          </a>
          <form method="POST" action="{% url 'product-delete' product.id %}" 
                onsubmit="return confirm('Are you sure you want to delete this product?');"
                class="d-inline">
            {% csrf_token %}
            <button type="submit" class="btn btn-pink shadow px-4 py-2">
              <i class="fas fa-trash-alt me-1"></i> Delete
            </button>
          </form>
        {% else %}
          <!-- Normal User: Add to Cart / Buy Now -->
          {% if request.user.is_authenticated %}
            {% if item_already_in_cart %}
              <a href="{% url 'showcart' %}" class="btn btn-pink shadow px-4 py-2">Go to Cart</a>
              <form action="{% url 'checkout' %}" method="POST" class="d-inline">
                {% csrf_token %}
                <input type="hidden" name="prod_id" value="{{ product.id }}">
                <button type="submit" class="btn btn-primary shadow px-4 py-2">Order Now</button>
              </form>
            {% else %}
              <form action="{% url 'add-to-cart' %}" method="POST" class="d-inline">
                {% csrf_token %}
                <input type="hidden" name="prod_id" value="{{ product.id }}">
                <button type="submit" class="btn btn-pink shadow px-4 py-2">Add to Cart</button>
              </form>
              <form action="{% url 'checkout' %}" method="POST" class="d-inline">
                {% csrf_token %}
                <input type="hidden" name="prod_id" value="{{ product.id }}">
                <button type="submit" class="btn btn-primary shadow px-4 py-2">Order Now</button>
              </form>
            {% endif %}
          {% else %}
            <!-- Guest: Add to Cart + Order Now -->
            <form action="{% url 'add-to-cart' %}?next={% url 'product-detail' pk=product.id %}" method="POST" class="d-inline">
              {% csrf_token %}
              <input type="hidden" name="prod_id" value="{{ product.id }}">
              <button type="submit" class="btn btn-pink shadow px-4 py-2">Add to Cart</button>
            </form>
            <a href="{% url 'checkout' %}" class="btn btn-primary shadow px-4 py-2">Order Now</a>
          {% endif %}
        {% endif %}
      </div>

      <!-- Available Offers -->
      <div class="mt-5">
        <h5 class="fw-bold mb-3">Available Offers</h5>
        <ul class="list-group list-group-flush">
          <li class="list-group-item"><i class="fas fa-check-circle text-success me-2"></i> Free delivery</li>
          <li class="list-group-item"><i class="fas fa-check-circle text-success me-2"></i> 10% instant cashback in mobile banking</li>
          <li class="list-group-item"><i class="fas fa-check-circle text-success me-2"></i> No cost EMI. Standard EMI also available</li>
        </ul>
      </div>
    </div>
  </div>

  <!-- Payment Options -->
  <div class="row mt-5">
    <div class="col-12">
      <div class="card shadow-sm">
        <div class="card-body text-center">
          <h5 class="mb-4">We Accept</h5>
          <div class="d-flex flex-wrap justify-content-center gap-3">
            <div class="payment-logo bkash">
              <img src="{% static 'app/images/payavail/bk.PNG' %}" alt="bKash">
            </div>
            <div class="payment-logo nagad">
              <img src="{% static 'app/images/payavail/ngd.PNG' %}" alt="Nagad">
            </div>
            <div class="payment-logo visa">
              <i class="fab fa-cc-visa"></i>
            </div>
            <div class="payment-logo mastercard">
              <i class="fab fa-cc-mastercard"></i>
            </div>
            <div class="payment-logo paypal">
              <i class="fab fa-cc-paypal"></i>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Styles -->
  <style>
    .payment-logo {
      width: 70px;
      height: 70px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 32px;
      color: white;
      cursor: pointer;
      transition: all 0.3s ease;
    }
    .payment-logo img { max-width: 60%; max-height: 60%; object-fit: contain; }
    .payment-logo:hover { transform: scale(1.1); box-shadow: 0 6px 15px rgba(0,0,0,0.2); }
    .bkash { background: #E2136E; }
    .nagad { background: #F6931E; }
    .rocket { background: #7B2CBF; }
    .visa { background: #1A1F71; }
    .mastercard { background: #EB001B; }
    .paypal { background: #003087; }

    /* Buttons */
    .btn-pink {
      background-color: #d63384; color: #fff; border-radius: 50px; padding: 8px 20px; transition: all 0.3s ease; border: none;
    }
    .btn-pink:hover { background-color: #ff66a3; color: #fff; transform: translateY(-2px); }

    .btn-primary {
      background-color: #007bff; color: #fff; border-radius: 50px; padding: 8px 20px; transition: all 0.3s ease; border: none;
    }
    .btn-primary:hover { background-color: #0069d9; transform: translateY(-2px); }
  </style>
</div>
{% endblock main-content %}
