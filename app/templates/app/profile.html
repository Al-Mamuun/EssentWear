{% extends 'app/base.html' %}
{% load static %}

{% block title %}Profile{% endblock title %}

{% block main-content %}
<div class="container my-5">
  <div class="row">
    <!-- Sidebar -->
    <div class="col-md-3 mb-4">
      <div class="list-group shadow-sm rounded-3">
        <a href="#" class="list-group-item list-group-item-action active"
           style="background: linear-gradient(90deg, #ff758c, #ff7eb3); border: none;">
          <i class="fas fa-user-circle me-2"></i> Account Information
        </a>
        <a href="{% url 'orders' %}" class="list-group-item list-group-item-action">
          <i class="fas fa-box me-2 text-pink"></i> My Orders
        </a>
        <a href="{% url 'changepassword' %}" class="list-group-item list-group-item-action">
          <i class="fas fa-key me-2 text-pink"></i> Change Password
        </a>
        <a href="{% url 'address' %}" class="list-group-item list-group-item-action">
          <i class="fas fa-map-marker-alt me-2 text-pink"></i> Manage Addresses
        </a>
      </div>
    </div>

    <!-- Main Content -->
    <div class="col-md-9">
      <!-- Account Info Card -->
      <div class="card shadow-sm rounded-3 mb-4 border-0">
        <div class="card-header text-white d-flex justify-content-between align-items-center"
             style="background: linear-gradient(90deg, #ff758c, #ff7eb3);">
          <h5 class="mb-0"><i class="fas fa-user me-2"></i> Account Information</h5>
          <button class="btn btn-light btn-sm" onclick="toggleForm()">
            <i class="fas fa-edit me-1"></i> Edit
          </button>
        </div>
        <div class="card-body">
          <div class="row mb-2">
            <div class="col-md-6">
              <p><strong>Name:</strong> {% if profile %}{{ profile.name|default:request.user.get_full_name }}{% else %}{{ request.user.get_full_name }}{% endif %}</p>
              <p><strong>Phone:</strong> {% if profile %}{{ profile.phone_no|default:"Not Added" }}{% else %}Not Added{% endif %}</p>
              <p><strong>Gender:</strong> {% if profile %}{{ profile.gender|default:"Not Specified" }}{% else %}Not Specified{% endif %}</p>
            </div>
            <div class="col-md-6">
              <p><strong>Email:</strong> {{ request.user.email }}</p>
              <p><strong>Address:</strong> {% if profile %}{{ profile.address|default:"Not Added" }}{% else %}Not Added{% endif %}</p>
            </div>
          </div>
        </div>
      </div>

      <!-- Edit Profile Form -->
      <div id="editForm" class="card shadow-sm rounded-3 mb-4 border-0" style="display:none; overflow: hidden;">
        <div class="card-header text-white"
             style="background: linear-gradient(90deg, #ff758c, #ff7eb3);">
          <h5 class="mb-0"><i class="fas fa-edit me-2"></i> Edit Profile</h5>
        </div>
        <div class="card-body">
          <form method="POST">
            {% csrf_token %}
            <div class="row g-3">
              <div class="col-md-6">
                <label for="id_name" class="form-label">Full Name</label>
                <input type="text" name="name" id="id_name" class="form-control"
                       value="{% if profile %}{{ profile.name }}{% else %}{{ request.user.get_full_name }}{% endif %}" required>
              </div>
              <div class="col-md-6">
                <label for="id_gender" class="form-label">Gender</label>
                <select name="gender" id="id_gender" class="form-select">
                  <option value="">Select Gender</option>
                  <option value="Male" {% if profile.gender == "Male" %}selected{% endif %}>Male</option>
                  <option value="Female" {% if profile.gender == "Female" %}selected{% endif %}>Female</option>
                  <option value="Other" {% if profile.gender == "Other" %}selected{% endif %}>Other</option>
                </select>
              </div>
              <div class="col-md-6">
                <label for="id_phone" class="form-label">Phone</label>
                <input type="text" name="phone_no" id="id_phone" class="form-control"
                       value="{% if profile %}{{ profile.phone_no }}{% endif %}">
              </div>
              <div class="col-md-6">
                <label for="id_email" class="form-label">Email</label>
                <input type="email" name="email" id="id_email" class="form-control"
                       value="{{ request.user.email }}" required>
              </div>
              <div class="col-md-12">
                <label for="id_address" class="form-label">Address</label>
                <textarea name="address" id="id_address" class="form-control" rows="2">{% if profile %}{{ profile.address }}{% endif %}</textarea>
              </div>
            </div>

            <div class="mt-4 d-flex">
              <button type="submit" class="btn btn-pink-gradient me-2"><i class="fas fa-save me-1"></i> Save Changes</button>
              <button type="button" class="btn btn-secondary" onclick="toggleForm()">Cancel</button>
            </div>
          </form>
        </div>
      </div>

      <!-- Recent Orders -->
      <div class="card shadow-sm rounded-3 mb-4 border-0">
        <div class="card-header text-white d-flex justify-content-between align-items-center"
             style="background: linear-gradient(90deg, #ff758c, #ff7eb3);">
          <h5 class="mb-0"><i class="fas fa-box me-2"></i> Recent Orders</h5>
          <a href="{% url 'orders' %}" class="btn btn-light btn-sm">
            <i class="fas fa-eye me-1"></i> View All
          </a>
        </div>
        <div class="card-body">
          {% if order_placed %}
          <div class="table-responsive">
            <table class="table table-bordered table-hover align-middle">
              <thead class="table-light">
                <tr>
                  <th>#</th>
                  <th>Product</th>
                  <th>Quantity</th>
                  <th>Price</th>
                  <th>Status</th>
                </tr>
              </thead>
              <tbody>
                {% for op in order_placed %}
                <tr>
                  <td>{{ forloop.counter }}</td>
                  <td>{{ op.product.title }}</td>
                  <td>{{ op.quantity }}</td>
                  <td>{{ op.total_cost }} à§³</td>
                  <td>
                    <span class="badge rounded-pill 
                      {% if op.status == 'Accepted' %}bg-primary
                      {% elif op.status == 'Packed' %}bg-info text-dark
                      {% elif op.status == 'On The Way' %}bg-warning text-dark
                      {% elif op.status == 'Delivered' %}bg-success
                      {% elif op.status == 'Cancel' %}bg-danger
                      {% else %}bg-secondary
                      {% endif %}">
                      {{ op.status }}
                    </span>
                  </td>
                </tr>
                {% endfor %}
              </tbody>
            </table>
          </div>
          {% else %}
          <div class="alert alert-info shadow-sm rounded-3 text-center">
            <i class="fas fa-info-circle me-2"></i> You have not placed any orders yet.
          </div>
          {% endif %}
        </div>
      </div>
    </div>
  </div>
</div>

<style>
  .btn-pink-gradient {
    background: linear-gradient(90deg, #ff758c, #ff7eb3);
    color: white;
    border: none;
  }
  .btn-pink-gradient:hover {
    background: linear-gradient(90deg, #ff7eb3, #ff758c);
    color: white;
  }
  .text-pink {
    color: #ff758c !important;
  }
</style>

<script>
function toggleForm() {
  let form = document.getElementById("editForm");
  if(form.style.display === "none") {
    form.style.display = "block";
    form.scrollIntoView({ behavior: 'smooth', block: 'start' });
  } else {
    form.style.display = "none";
  }
}
</script>
{% endblock main-content %}
